\documentclass[10pt]{report}
\usepackage[utf8]{inputenc}
\usepackage{a4wide, amsmath, xcolor, longtable, geometry, fancyhdr, mathtools, array, listings}
\usepackage[style = numeric, backend = biber]{biblatex}
\usepackage{fouriernc}
\usepackage[T1]{fontenc}
\geometry{a4paper, top = 15mm, left = 5mm, right = 5mm, bottom = 17mm}
\fancypagestyle{plain}{
\fancyhead[L]{\texttt{GAME} handbook}
\fancyhead[R]{\textsc{\texttt{GAME} development team}}
\fancyfoot[C]{\thepage}
\addtolength\footskip{12pt}}
\definecolor{table_green}{rgb}{0, 0.6, 0}
\title{\texttt{GAME} Handbook}
\author{\texttt{GAME} Development Team}
\date{}
\newcommand{\md}[1]{\frac{D#1}{Dt}}
\newcommand{\omegabi}{\text{{\osgbi ω}}}
\newcommand{\mubi}{\text{{\osgbi μ}}}
\newcommand{\sigmabi}{\text{{\osgbi σ}}}
\newcommand{\epsilonbi}{\text{{\osgbi ϵ}}}
\newcommand{\etabi}{\text{{\osgbi η}}}
\newcommand{\zetabi}{\text{{\osgbi ζ}}}

\begin{document}

\maketitle

\vspace*{5 cm}
\begin{center}
All physical quantities in this document are to be multiplied with their respective SI units.
\end{center}

\newpage

\chapter{Overview}
\label{chap:overview}

The \texttt{GAME} projects incorporates four different executables:

\begin{itemize}
\item \texttt{grid\_generator}, a program for creating model grids
\item \texttt{orography\_generator}, a tool for creating orography files
\item \texttt{test\_generator}, a tool for creating initialization states of test scenarios
\item \texttt{game}, the model executable itself
\end{itemize}

\chapter{Installation}
\label{chap:installation}

\section{Dependencies}
\label{sec:dependencies}

The following dependencies must be installed before being able to successfully build the model:

\begin{itemize}
\item geos95 \url{https://github.com/MHBalsmeier/geos95}
\item netcdf library
\item eccodes library (installation manual: \url{https://mhbalsmeier.github.io/tutorials/eccodes_on_ubuntu.html})
\item CMake
\item atmostracers (\url{https://github.com/MHBalsmeier/atmostracers})
\item rte-rrtmgp-c (\url{https://github.com/MHBalsmeier/rte-rrtmgp-c})
\item Python (only for the plotting routines, which are of course not part of the actual model)
\item OpenMPI (not yet)
\end{itemize}

\section{Building}
\label{sec:building}

\texttt{CMake} is used for building \texttt{GAME}. The building process is managed using the bash scripts in the directory \texttt{build\_scripts}. The following list gives an overview of the scripts residing in this directory:

\begin{itemize}
\item \texttt{debug.sh}: 
\item \texttt{build.sh}: The installation directory is controlled by the variable \texttt{aim\_dir}.
\item \texttt{install\_output.sh}: 
\item \texttt{build\_install.sh}:
\item \texttt{install\_plotting\_routines.sh}:
\item \texttt{install\_run\_scripts.sh}: 
\end{itemize}

Scripts with the suffix \texttt{\_dev} are not different from the original scripts, they allow choosing a different installation directory for installations of test versions.

\chapter{Running the model}
\label{chap:running_the_model}

The configuration of the model must be set in three different files:

\begin{itemize}
\item \texttt{src/enum\_and\_typedefs.h}: modify \texttt{RES\_ID}, \texttt{NO\_OF\_LAYERS} and \texttt{NO\_OF\_ORO\_LAYERS}. These must conform with the grid file and the initialization state file.
\item The file \texttt{src/settings.c}: modify the characteristics of damping at the model top and diffusion.
\item The run script: explanation below.
\end{itemize}

\lstinputlisting[language = Bash, caption = {Example input file.}, frame = on]{../run_scripts/jw_pert_moist.sh}\label{lst:input_file_example}

Listing \ref{lst:input_file_example} is an example of an input file. Table \ref{tab:input_file_explanation} explains the meanings of the variables.

\renewcommand{\arraystretch}{1.2}
\begin{table}
\centering
\begin{tabular}{|>{\centering}p{5.0 cm}|>{\centering}p{3 cm}|>{\centering}p{7 cm}|}
\hline \textbf{name} & \textbf{domain} & \textbf{meaning} \tabularnewline
\hline\hline operator & string & Operator of the model, for example \texttt{Company XYZ, Inc.} \tabularnewline
\hline overwrite\_run\_id & 0, 1 & if 0: use auto-generated run\_id, if 1: use manually set run\_id (see next line) \tabularnewline
\hline run\_id & string (optional) & run\_id to be used if overwrite\_run\_id is set to 1 \tabularnewline
\hline run\_span & integer & How long the model shall run into the future. \tabularnewline
\hline write\_out\_interval & integer $\geq$ 900 & Every how many seconds autput shall be generated. \tabularnewline
\hline grid\_props\_file & string & File name of the grid properties file. \tabularnewline
\hline init\_state\_filename & string & File name of the initialization state file. \tabularnewline
\hline init\_state\_file & string & Full path of the initialization state file. \tabularnewline
\hline output\_dir\_base & string & The directory to which output shall be written. \tabularnewline
\hline cfl\_margin & double & Manual reduction of the time step below the CFL criterion: $\Delta t = \left(1 - \text{cfl\_margin}\right)\Delta t^{(\text{CFL})}$. \tabularnewline
\hline temperature\_diff\_h & 0, 1 & horizontal temperature diffusion switch \tabularnewline
\hline temperature\_diff\_v & 0, 1 & vertical temperature diffusion switch \tabularnewline
\hline momentum\_diff\_h & 0, 1 & horizontal momentum diffusion switch \tabularnewline
\hline momentum\_diff\_v & 0, 1 & vertical momentum diffusion switch \tabularnewline
\hline dissipation\_on & 10, 1 & dissipation switch \tabularnewline
\hline tracers\_on & 0, 1 & tracers switch \tabularnewline
\hline rad\_on & 0, 1 & radiation switch \tabularnewline
\hline radiation\_delta\_t & double $\geq \Delta t$ & Every how many seconds the radiation flux densities shall be updated.  \tabularnewline
\hline write\_out\_mass\_dry\_integral & 0, 1 & Switch to decide wether a global integral of dry mass shall be written out at every time step. \tabularnewline
\hline write\_out\_entropy\_gas\_integral & 0, 1 & Switch to decide wether a global integral of the entropy shall be written out at every time step. \tabularnewline
\hline write\_out\_energy\_integral & 0, 1 & Switch to decide wether a global integral of the energy shall be written out at every time step. \tabularnewline
\hline
\end{tabular}
\caption{Input file explanation.}
\label{tab:input_file_explanation}
\end{table}
\renewcommand{\arraystretch}{1}

\chapter{Grid generation procedure}
\label{chap:grid_generation_procedure}

A grid is determined by the following five properties:

\begin{itemize}
\item the resolution, specified via the parameter \texttt{RES\_ID}
\item the orography, specified via the parameter \texttt{ORO\_ID}
\item the height of the top of the atmosphere, specified via the parameter \texttt{TOA}
\item the number of layers, specified via the parameter \texttt{NUMBER\_OF\_LAYERS}
\item the number of layers following the orography, specified via the parameter \texttt{NUMBER\_OF\_ORO\_LAYERS}
\end{itemize}
%
The grid generator needs to be recompiled for every specific resolution, top height, number of layers as well as number of orography following layers. Therefore change the respective constants in the file \texttt{grid\_generator.c} and execute the bash script \texttt{compile.sh}. Then run the grid generator using the bash script \texttt{run.sh} with the desired \texttt{\texttt{ORO\_ID}}. Table \ref{tab:grid_generator_run_file_explanation} explains all the parameters to be set in \texttt{run.sh}. Otimized grids have the postfix \texttt{\_SCVT}.

\renewcommand{\arraystretch}{1.2}
\begin{table}
\centering
\begin{tabular}{|>{\centering}p{5.0 cm}|>{\centering}p{3 cm}|>{\centering}p{7 cm}|}
\hline \textbf{name} & \textbf{domain} & \textbf{meaning} \tabularnewline
\hline\hline \texttt{\texttt{ORO\_ID}} & all value for which an orography is defined & orography ID \tabularnewline
\hline\hline \texttt{optimize} & 0, 1 & optimization switch (fails if \texttt{\texttt{ORO\_ID}} is not 0) \tabularnewline
\hline\hline \texttt{n\_iterations} & integer $\geq$ 1 & number of iterations (ignored if \texttt{optimize} = 0), 2000 seems to be a safe value \tabularnewline
\hline\hline \texttt{use\_scalar\_h\_coords\_file} & 0, 1 & switch to determine wether horizontal coordinates of triangle vertices (generators of the grid) shall be used from another file \tabularnewline
\hline\hline \texttt{scalar\_h\_coords\_file} & string & input file for dual triangle vertices (only relevant if \texttt{use\_scalar\_h\_coords\_file} = 1) \tabularnewline
\hline
\end{tabular}
\caption{Grid generator run script explanation.}
\label{tab:grid_generator_run_file_explanation}
\end{table}
\renewcommand{\arraystretch}{1}

\chapter{Generating a new orography file}
\label{chap:generating_a_new_orography_file}

\renewcommand{\arraystretch}{1.2}
\begin{table}
\centering
\begin{tabular}{|>{\centering}p{4.0 cm}|>{\centering}p{8 cm}|}
\hline \textbf{\texttt{ORO\_ID}} & \textbf{Description} \tabularnewline
\hline\hline 0 & no orography \tabularnewline
\hline 1 & orography of JW test \tabularnewline
\hline 2 & Gaussian mountain of 8 km height and 224 m standard deviation located ad 0 N / 0 E\tabularnewline
\hline $\geq$ 3 & real orography \tabularnewline
\hline
\end{tabular}
\caption{Definition of orography IDs.}
\label{tab:oro_id_definition}
\end{table}
\renewcommand{\arraystretch}{1}

Orography files are generated with the code residing in the directory \texttt{orography\_generator/src}. Firstly, change the parameter \texttt{RES\_ID} in the file \texttt{orography\_generator.c} to the desired value and compile. Then source the bash scribt \texttt{run.sh} with the desired \texttt{\texttt{ORO\_ID}}. Tab. \ref{tab:oro_id_definition} shows the definition of the orography IDs. Real orography can be downloaded from
%
\begin{itemize}
\item \texttt{https://psl.noaa.gov/cgi-bin/db\_search/DBSearch.pl?Dataset=NCEP+Reanalysis\\\&Variable=Geopotential+height\&group=0\&submit=Search} (\texttt{ORO\_ID} = 3)
\end{itemize}
%
These files are stored in the directory \texttt{orography\_generator/real}. An information file explains them and defines their individual \texttt{ORO\_ID}s. A $1/r$-interpolation with four values is used to interpolate the data to the scalar data points.

\chapter{Generating a new test state file}
\label{chap:generating_a_new_test_state_file}

\renewcommand{\arraystretch}{1.2}
\begin{table}
\centering
\begin{tabular}{|>{\centering}p{4.0 cm}|>{\centering}p{8 cm}|}
\hline \textbf{\texttt{TEST\_ID}} & \textbf{Description} \tabularnewline
\hline\hline 0 & standard atmosphere \tabularnewline
\hline\hline 1 & standard atmosphere with Gaussian mountain (\texttt{ORO\_ID} = 2) \tabularnewline
\hline\hline 2 & JW dry unperturbed \tabularnewline
\hline 3 & JW dry perturbed \tabularnewline
\hline 4 & JW moist unperturbed \tabularnewline
\hline 5 & JW moist perturbed \tabularnewline
\hline 6 & JW dry, balanced, with \texttt{ORO\_ID} = 3 \tabularnewline
\hline 7 & JW moist, balanced, with \texttt{ORO\_ID} = 3 \tabularnewline
\hline
\end{tabular}
\caption{Definition of test IDs.}
\label{tab:test_id_definition}
\end{table}
\renewcommand{\arraystretch}{1}

A new test state can be generated with the code in the directory \texttt{test\_generator/src}. Therefore, firstly change the parameters \texttt{RES\_ID}, \texttt{NUMBER\_OF\_LAYERS} and \texttt{NUMBER\_OF\_ORO\_LAYERS} in the file \texttt{test\_generator.c}. Then compile by sourcing the file \texttt{compile.sh} before executing the file \texttt{run.sh} with the specific \texttt{test\_id}. Tab. \ref{tab:test_id_definition} shows the definition of the test IDs.

\end{document}













